{% extends 'monitoring/base.html' %}
{% block content %}
<section class="contacts-card">
  <h2>Emergency Contacts</h2>
  <form id="contactForm">
    <input type="text" id="c_name" placeholder="Name" required/>
    <input type="text" id="c_phone" placeholder="Phone"/>
    <input type="email" id="c_email" placeholder="Email"/>
    <button type="submit">Add Contact</button>
  </form>

  <div id="contactsList"></div>
</section>
{% endblock %}

{% block scripts %}
<script src="{% static 'monitoring/js/ajax_api.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm');
    const list = document.getElementById('contactsList');

    function refresh(){
      apiGet('/api/contacts/').then(data => {
        list.innerHTML = '';
        data.contacts.forEach(c => {
          const div = document.createElement('div');
          div.className = 'contact-row';
          div.innerHTML = `<strong>${c.name}</strong> ${c.phone ? '• ' + c.phone : ''} ${c.email ? '• ' + c.email : ''}`;
          list.appendChild(div);
        });
      });
    }

    form.onsubmit = (e) => {
      e.preventDefault();
      const payload = {
        name: document.getElementById('c_name').value,
        phone: document.getElementById('c_phone').value,
        email: document.getElementById('c_email').value
      };
      apiPost('/api/contacts/', payload).then(()=> {
        form.reset();
        refresh();
      });
    };

    refresh();
  });
</script>
{% endblock %}
